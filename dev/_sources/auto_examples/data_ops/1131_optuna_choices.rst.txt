
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/data_ops/1131_optuna_choices.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_data_ops_1131_optuna_choices.py>`
        to download the full example code or to run this example in your browser via JupyterLite or Binder.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_data_ops_1131_optuna_choices.py:


.. currentmodule:: skrub
.. _example_optuna_choices:

Tuning DataOps with Optuna
==========================

This example shows how to use `Optuna
<https://optuna.readthedocs.io/en/stable/>`_ to tune the hyperparameters of a
skrub :class:`DataOp`. As seen in the previous example, skrub DataOps can contain
"choices", objects created with :func:`choose_from`, :func:`choose_int`,
:func:`choose_float`, etc. and we can use hyperparameter search techniques to
pick the best outcome for each choice. Performing this search with Optuna
allows us to benefit from its many features, such as state-of-the-art search
strategies, monitoring and visualization, stopping and resuming searches, and
parallel or distributed computation.

In order to use Optuna with skrub, the package must be installed first.
This can be done with pip:

.. code-block:: bash

    pip install optuna

.. GENERATED FROM PYTHON SOURCE LINES 28-34

A simple regressor and example data.
------------------------------------

We will fit a regressor containing a few choices on a toy dataset. We
try 2 regressors: gradient boosting and random forest. They both have
hyperparameters that we want to tune.

.. GENERATED FROM PYTHON SOURCE LINES 36-55

.. code-block:: Python

    from sklearn.ensemble import ExtraTreesRegressor
    from sklearn.linear_model import Ridge

    import skrub

    extra_tree = ExtraTreesRegressor(
        min_samples_leaf=skrub.choose_int(1, 32, log=True, name="min_samples_leaf"),
    )
    ridge = Ridge(alpha=skrub.choose_float(0.01, 10.0, log=True, name="α"))

    regressor = skrub.choose_from(
        {"extra_tree": extra_tree, "ridge": ridge}, name="regressor"
    )
    data = skrub.var("data")
    X = data.drop(columns="MedHouseVal", errors="ignore").skb.mark_as_X()
    y = data["MedHouseVal"].skb.mark_as_y()
    pred = X.skb.apply(regressor, y=y)
    print(pred.skb.describe_param_grid())





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    - regressor: 'extra_tree'
      min_samples_leaf: choose_int(1, 32, log=True, name='min_samples_leaf')
    - regressor: 'ridge'
      α: choose_float(0.01, 10.0, log=True, name='α')





.. GENERATED FROM PYTHON SOURCE LINES 56-57

Load data for the example

.. GENERATED FROM PYTHON SOURCE LINES 59-69

.. code-block:: Python

    from sklearn.datasets import fetch_california_housing
    from sklearn.model_selection import KFold

    # (We subsample the dataset by half to make the example run faster)
    df = fetch_california_housing(as_frame=True).frame.sample(10_000, random_state=0)

    # The environment we will use to fit the learners created by our DataOp.
    env = {"data": df}
    cv = KFold(n_splits=4, shuffle=True, random_state=0)








.. GENERATED FROM PYTHON SOURCE LINES 70-82

Selecting the best hyperparameters with Optuna.
-----------------------------------------------

The simplest way to use Optuna is to pass ``backend='optuna'`` to
:meth:`DataOp.skb.make_randomized_search()`. It is used very similarly as
with the default backend
(:class:`sklearn.model_selection.RandomizedSearchCV`). Additional
parameters are available to control the Optuna sampler, storage and study
name, and timeout.
Note that in order to persist the study and resume it later, the ``storage``
parameter must be set to a valid database URL (e.g., a SQLite file). Refer to
the User Guide for an example.

.. GENERATED FROM PYTHON SOURCE LINES 84-88

.. code-block:: Python

    search = pred.skb.make_randomized_search(backend="optuna", cv=cv, n_iter=10)
    search.fit(env)
    search.results_





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Running optuna search for study skrub_randomized_search_1326c6c3-0554-427b-938d-fbdd2c434010 in storage /tmp/tmpqy76ukl4_skrub_optuna_search_storage/optuna_storage
    [I 2025-12-09 15:27:59,248] A new study created in Journal with name: skrub_randomized_search_1326c6c3-0554-427b-938d-fbdd2c434010
    [I 2025-12-09 15:28:02,318] Trial 0 finished with value: 0.7652881473233559 and parameters: {'2:regressor': '0:extra_tree', '0:min_samples_leaf': 6}. Best is trial 0 with value: 0.7652881473233559.
    [I 2025-12-09 15:28:04,416] Trial 1 finished with value: 0.7166275246081899 and parameters: {'2:regressor': '0:extra_tree', '0:min_samples_leaf': 21}. Best is trial 0 with value: 0.7652881473233559.
    [I 2025-12-09 15:28:04,666] Trial 2 finished with value: 0.5999128192700078 and parameters: {'2:regressor': '1:ridge', '1:α': 2.53257860062555}. Best is trial 0 with value: 0.7652881473233559.
    [I 2025-12-09 15:28:04,915] Trial 3 finished with value: 0.5998983778241221 and parameters: {'2:regressor': '1:ridge', '1:α': 0.4193784471459371}. Best is trial 0 with value: 0.7652881473233559.
    [I 2025-12-09 15:28:13,163] Trial 4 finished with value: 0.794182310175938 and parameters: {'2:regressor': '0:extra_tree', '0:min_samples_leaf': 1}. Best is trial 4 with value: 0.794182310175938.
    [I 2025-12-09 15:28:16,734] Trial 5 finished with value: 0.7748953283529009 and parameters: {'2:regressor': '0:extra_tree', '0:min_samples_leaf': 4}. Best is trial 4 with value: 0.794182310175938.
    [I 2025-12-09 15:28:21,817] Trial 6 finished with value: 0.790706770010962 and parameters: {'2:regressor': '0:extra_tree', '0:min_samples_leaf': 2}. Best is trial 4 with value: 0.794182310175938.
    [I 2025-12-09 15:28:24,455] Trial 7 finished with value: 0.7526033083987798 and parameters: {'2:regressor': '0:extra_tree', '0:min_samples_leaf': 9}. Best is trial 4 with value: 0.794182310175938.
    [I 2025-12-09 15:28:27,485] Trial 8 finished with value: 0.766132414324147 and parameters: {'2:regressor': '0:extra_tree', '0:min_samples_leaf': 6}. Best is trial 4 with value: 0.794182310175938.
    [I 2025-12-09 15:28:31,051] Trial 9 finished with value: 0.7759210273415043 and parameters: {'2:regressor': '0:extra_tree', '0:min_samples_leaf': 4}. Best is trial 4 with value: 0.794182310175938.
    [I 2025-12-09 15:28:31,052] A new study created in memory with name: skrub_randomized_search_1326c6c3-0554-427b-938d-fbdd2c434010


.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>
    <style scoped>
        .dataframe tbody tr th:only-of-type {
            vertical-align: middle;
        }

        .dataframe tbody tr th {
            vertical-align: top;
        }

        .dataframe thead th {
            text-align: right;
        }
    </style>
    <table border="1" class="dataframe">
      <thead>
        <tr style="text-align: right;">
          <th></th>
          <th>min_samples_leaf</th>
          <th>α</th>
          <th>regressor</th>
          <th>mean_test_score</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th>0</th>
          <td>1.0</td>
          <td>NaN</td>
          <td>extra_tree</td>
          <td>0.794182</td>
        </tr>
        <tr>
          <th>1</th>
          <td>2.0</td>
          <td>NaN</td>
          <td>extra_tree</td>
          <td>0.790707</td>
        </tr>
        <tr>
          <th>2</th>
          <td>4.0</td>
          <td>NaN</td>
          <td>extra_tree</td>
          <td>0.775921</td>
        </tr>
        <tr>
          <th>3</th>
          <td>4.0</td>
          <td>NaN</td>
          <td>extra_tree</td>
          <td>0.774895</td>
        </tr>
        <tr>
          <th>4</th>
          <td>6.0</td>
          <td>NaN</td>
          <td>extra_tree</td>
          <td>0.766132</td>
        </tr>
        <tr>
          <th>5</th>
          <td>6.0</td>
          <td>NaN</td>
          <td>extra_tree</td>
          <td>0.765288</td>
        </tr>
        <tr>
          <th>6</th>
          <td>9.0</td>
          <td>NaN</td>
          <td>extra_tree</td>
          <td>0.752603</td>
        </tr>
        <tr>
          <th>7</th>
          <td>21.0</td>
          <td>NaN</td>
          <td>extra_tree</td>
          <td>0.716628</td>
        </tr>
        <tr>
          <th>8</th>
          <td>NaN</td>
          <td>2.532579</td>
          <td>ridge</td>
          <td>0.599913</td>
        </tr>
        <tr>
          <th>9</th>
          <td>NaN</td>
          <td>0.419378</td>
          <td>ridge</td>
          <td>0.599898</td>
        </tr>
      </tbody>
    </table>
    </div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 89-91

The usual ``results_``, ``detailed_results_`` and ``plot_results()`` are
still available.

.. GENERATED FROM PYTHON SOURCE LINES 93-95

.. code-block:: Python

    search.plot_results()






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>                        <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
            <script charset="utf-8" src="https://cdn.plot.ly/plotly-3.3.0.min.js" integrity="sha256-bO3dS6yCpk9aK4gUpNELtCiDeSYvGYnK7jFI58NQnHI=" crossorigin="anonymous"></script>                <div id="3494f267-91c0-4f29-afad-15393723d2c0" class="plotly-graph-div" style="height:100%; width:100%;"></div>            <script type="text/javascript">                window.PLOTLYENV=window.PLOTLYENV || {};                                if (document.getElementById("3494f267-91c0-4f29-afad-15393723d2c0")) {                    Plotly.newPlot(                        "3494f267-91c0-4f29-afad-15393723d2c0",                        [{"dimensions":[{"label":"min_samples_leaf","ticktext":["NaN","1","2","3","4","5","8","11","15","21"],"tickvals":[-0.3044522437723423,0.0,0.6931471805599453,1.0986122886681098,1.3862943611198906,1.6094379124341003,2.0794415416798357,2.3978952727983707,2.70805020110221,3.044522437723423],"values":{"dtype":"f8","bdata":"EWtZSk6rgL\u002fjZUIeJlTmP+09orLeQvY\u002flcMIWCVr9j8h3toMROr8P1fi5i6B2\u002fw\u002foKFa3kCDAUCxrm+ULlsIQMGLjEMlfNO\u002fwYuMQyV8078="}},{"label":"\u03b1","ticktext":["NaN","0.4","0.5","0.6","0.8","0.9","1.1","1.4","1.7","2.1","2.5"],"tickvals":[-1.0488035060678338,-0.8689815515679169,-0.6691793799013426,-0.46937720823476814,-0.2695750365681937,-0.06977286490161938,0.13002930676495494,0.3298314784315295,0.5296336500981038,0.7294358217646781,0.9292379934312525],"values":{"dtype":"f8","bdata":"Ht1nL+bH8L8e3Wcv5sfwvx7dZy\u002fmx\u002fC\u002fHt1nL+bH8L8e3Wcv5sfwvx7dZy\u002fmx\u002fC\u002f+eDupcHA8L8e3Wcv5sfwv9Cc\u002f1BRvO0\u002fNWYpdp6F678="}},{"label":"regressor","ticktext":["extra_tree","ridge"],"tickvals":[0,1],"values":{"dtype":"f8","bdata":"AAAAAAAAAAAAAAAAAAAAANQuc+5ZFFo\u002fAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAuPtW3fN9TD8wAwsi\u002fz5SPwAAAAAAAPA\u002fjMPkUa3i7z8="}},{"label":"score time","ticktext":["0.010","0.019","0.027","0.036","0.044","0.052","0.061","0.069","0.078","0.086"],"tickvals":[0.010208666324615479,0.018665399816301134,0.02712213330798679,0.03557886679967244,0.0440356002913581,0.05249233378304376,0.06094906727472941,0.06940580076641506,0.07786253425810072,0.08631926774978638],"values":{"dtype":"f8","bdata":"AAAAAAUZtj\u002fLdsJd8pavP7AIjkkjqqg\u002fqDmfvjzcqD8DLL1gW1WmP3Q8qjX7WKY\u002fS+1Uybo3pD9zSGO7uEOhP6eiZ2ovaYU\u002fAAAAAEjohD8="}},{"label":"fit time","ticktext":["0.0","0.2","0.4","0.7","0.9","1.1","1.3","1.5","1.7","1.9"],"tickvals":[0.012350738048553467,0.22604754898283216,0.43974435991711086,0.6534411708513895,0.8671379817856683,1.0808347927199469,1.2945316036542256,1.5082284145885043,1.721925225522783,1.9356220364570618],"values":{"dtype":"f8","bdata":"AAAA0E74\u002fj+VdXzi1sPyP5m2VKuO9ek\u002fBhFsSzC86T+UW0LoN3DlPx4EfVI+0OU\u002f7y9oXkHA4j80PUTO6zTdP6wBJVUzPo4\u002fAAAAAFhLiT8="}},{"label":"score","ticktext":["0.60","0.62","0.64","0.66","0.69","0.71","0.73","0.75","0.77","0.79"],"tickvals":[0.5998983778241221,0.6214854814187684,0.6430725850134146,0.6646596886080608,0.6862467922027069,0.7078338957973531,0.7294209993919993,0.7510081029866456,0.7725952065812918,0.794182310175938],"values":{"dtype":"f8","bdata":"ZI4oBfFp6T8yiL1IeE3pP0a8llVY1Og\u002fHSqjSfHL6D\u002f+r\u002f0fKIToP9almJE9feg\u002fpuSNiFMV6D8qYbPYnO7mPy7oZl58MuM\u002fo7I1FV4y4z8="}}],"labelangle":15,"labelside":"top","line":{"color":{"dtype":"f8","bdata":"ZI4oBfFp6T8yiL1IeE3pP0a8llVY1Og\u002fHSqjSfHL6D\u002f+r\u002f0fKIToP9almJE9feg\u002fpuSNiFMV6D8qYbPYnO7mPy7oZl58MuM\u002fo7I1FV4y4z8="},"colorbar":{"title":{"text":"score"}},"colorscale":[[0.0,"rgb(0,0,255)"],[1.0,"rgb(255,0,0)"]],"showscale":true},"type":"parcoords"}],                        {"font":{"size":18},"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermap":[{"type":"scattermap","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}}},                        {"responsive": true}                    )                };            </script>        </div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 96-98

The Optuna :class:`Study <optuna.study.Study>` that was used to run the
hyperparameter search is available in the attribute ``study_``:

.. GENERATED FROM PYTHON SOURCE LINES 100-102

.. code-block:: Python

    search.study_





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <optuna.study.study.Study object at 0x7fc31b9a1d00>



.. GENERATED FROM PYTHON SOURCE LINES 103-105

.. code-block:: Python

    search.study_.best_params





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    {'2:regressor': '0:extra_tree', '0:min_samples_leaf': 1}



.. GENERATED FROM PYTHON SOURCE LINES 106-111

This allows us to use Optuna's reporting capabilities provided in
`optuna.visualization
<https://optuna.readthedocs.io/en/stable/reference/visualization/>`_ or
`optuna-dashboard
<https://optuna-dashboard.readthedocs.io/en/latest/getting-started.html>`_.

.. GENERATED FROM PYTHON SOURCE LINES 113-117

.. code-block:: Python

    import optuna

    optuna.visualization.plot_slice(search.study_, params=["0:min_samples_leaf"])






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>                        <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
            <script charset="utf-8" src="https://cdn.plot.ly/plotly-3.3.0.min.js" integrity="sha256-bO3dS6yCpk9aK4gUpNELtCiDeSYvGYnK7jFI58NQnHI=" crossorigin="anonymous"></script>                <div id="18fd255c-cde0-491a-879a-ed027010dea4" class="plotly-graph-div" style="height:100%; width:100%;"></div>            <script type="text/javascript">                window.PLOTLYENV=window.PLOTLYENV || {};                                if (document.getElementById("18fd255c-cde0-491a-879a-ed027010dea4")) {                    Plotly.newPlot(                        "18fd255c-cde0-491a-879a-ed027010dea4",                        [{"marker":{"color":[0,1,4,5,6,7,8,9],"colorbar":{"title":{"text":"Trial"},"x":1.0,"xpad":40},"colorscale":[[0.0,"rgb(247,251,255)"],[0.125,"rgb(222,235,247)"],[0.25,"rgb(198,219,239)"],[0.375,"rgb(158,202,225)"],[0.5,"rgb(107,174,214)"],[0.625,"rgb(66,146,198)"],[0.75,"rgb(33,113,181)"],[0.875,"rgb(8,81,156)"],[1.0,"rgb(8,48,107)"]],"line":{"color":"Grey","width":0.5}},"mode":"markers","name":"Feasible Trial","showlegend":false,"x":[6,21,1,4,2,9,6,4],"y":[0.7652881473233559,0.7166275246081899,0.794182310175938,0.7748953283529009,0.790706770010962,0.7526033083987798,0.766132414324147,0.7759210273415043],"type":"scatter"}],                        {"title":{"text":"Slice Plot"},"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermap":[{"type":"scattermap","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"title":{"text":"0:min_samples_leaf"},"type":"log"},"yaxis":{"title":{"text":"Objective Value"}}},                        {"responsive": true}                    )                };            </script>        </div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 118-152

Using Optuna directly for more advanced use cases
-------------------------------------------------

Often we may want more control over the use of Optuna, or to access
functionality not available through :meth:`DataOp.skb.make_randomized_search`
such as the ask-and-tell interface, trial pruning, callbacks,
multi-objective optimization, etc. .

Directly using Optuna ourselves is also easy, as we will show now. What makes
this possible is that we can pass an Optuna Trial to
:meth:`DataOp.skb.make_learner` in which case the parameters suggested by the
trial are used to create the learner.

We revisit the example above, following the typical Optuna workflow.

The :class:`optuna.Study <optuna.study.Study>` runs the hyperparameter
search.

Its method :meth:`optimize <optuna.study.Study.optimize>` is given an
``objective`` function. The ``objective`` must accept a
:class:`~optuna.trial.Trial` object (which is produced by the study and picks
the parameters for a given evaluation of the objective) and return the value
to maximize (or minimize).

To use Optuna with a :class:`DataOp`, we just need to pass the Trial object
to :meth:`DataOp.skb.make_learner`. This creates a :class:`SkrubLearner`
initialized with the parameters picked by the optuna Trial.

We can then cross-validate the SkrubLearner, or score it however we prefer,
and return the score so that the optuna Study can take it into account.

Here we return a single score (R²), but multi-objective
optimization is also possible. Please refer to the Optuna documentation for
more information.

.. GENERATED FROM PYTHON SOURCE LINES 155-167

.. code-block:: Python



    def objective(trial):
        learner = pred.skb.make_learner(choose=trial)
        cv_results = skrub.cross_validate(learner, environment=env, cv=cv)
        return cv_results["test_score"].mean()


    study = optuna.create_study(direction="maximize")
    study.optimize(objective, n_trials=10)
    study.best_params





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    [I 2025-12-09 15:28:33,910] A new study created in memory with name: no-name-9486f34c-99e0-4d02-a8ec-a0c2bedb762d
    [I 2025-12-09 15:28:34,147] Trial 0 finished with value: 0.5998974061285484 and parameters: {'2:regressor': '1:ridge', '1:α': 0.2887712280381796}. Best is trial 0 with value: 0.5998974061285484.
    [I 2025-12-09 15:28:42,493] Trial 1 finished with value: 0.7937263372200245 and parameters: {'2:regressor': '0:extra_tree', '0:min_samples_leaf': 1}. Best is trial 1 with value: 0.7937263372200245.
    [I 2025-12-09 15:28:50,895] Trial 2 finished with value: 0.7931217834262223 and parameters: {'2:regressor': '0:extra_tree', '0:min_samples_leaf': 1}. Best is trial 1 with value: 0.7937263372200245.
    [I 2025-12-09 15:28:59,277] Trial 3 finished with value: 0.7927445587675209 and parameters: {'2:regressor': '0:extra_tree', '0:min_samples_leaf': 1}. Best is trial 1 with value: 0.7937263372200245.
    [I 2025-12-09 15:29:07,628] Trial 4 finished with value: 0.7935196350795335 and parameters: {'2:regressor': '0:extra_tree', '0:min_samples_leaf': 1}. Best is trial 1 with value: 0.7937263372200245.
    [I 2025-12-09 15:29:09,798] Trial 5 finished with value: 0.7242433288113767 and parameters: {'2:regressor': '0:extra_tree', '0:min_samples_leaf': 18}. Best is trial 1 with value: 0.7937263372200245.
    [I 2025-12-09 15:29:12,107] Trial 6 finished with value: 0.7365736288142888 and parameters: {'2:regressor': '0:extra_tree', '0:min_samples_leaf': 14}. Best is trial 1 with value: 0.7937263372200245.
    [I 2025-12-09 15:29:14,529] Trial 7 finished with value: 0.7378569685337195 and parameters: {'2:regressor': '0:extra_tree', '0:min_samples_leaf': 12}. Best is trial 1 with value: 0.7937263372200245.
    [I 2025-12-09 15:29:14,760] Trial 8 finished with value: 0.5999113510521907 and parameters: {'2:regressor': '1:ridge', '1:α': 2.3007763860886934}. Best is trial 1 with value: 0.7937263372200245.
    [I 2025-12-09 15:29:14,989] Trial 9 finished with value: 0.599909061298482 and parameters: {'2:regressor': '1:ridge', '1:α': 1.947825060516788}. Best is trial 1 with value: 0.7937263372200245.

    {'2:regressor': '0:extra_tree', '0:min_samples_leaf': 1}



.. GENERATED FROM PYTHON SOURCE LINES 168-169

We can also use Optuna's visualization capabilities to inspect the study:

.. GENERATED FROM PYTHON SOURCE LINES 169-171

.. code-block:: Python

    optuna.visualization.plot_optimization_history(study)






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>                        <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
            <script charset="utf-8" src="https://cdn.plot.ly/plotly-3.3.0.min.js" integrity="sha256-bO3dS6yCpk9aK4gUpNELtCiDeSYvGYnK7jFI58NQnHI=" crossorigin="anonymous"></script>                <div id="d26e11ba-4ed3-4056-b2d0-1b7ca1077e7f" class="plotly-graph-div" style="height:100%; width:100%;"></div>            <script type="text/javascript">                window.PLOTLYENV=window.PLOTLYENV || {};                                if (document.getElementById("d26e11ba-4ed3-4056-b2d0-1b7ca1077e7f")) {                    Plotly.newPlot(                        "d26e11ba-4ed3-4056-b2d0-1b7ca1077e7f",                        [{"mode":"markers","name":"Objective Value","x":[0,1,2,3,4,5,6,7,8,9],"y":[0.5998974061285484,0.7937263372200245,0.7931217834262223,0.7927445587675209,0.7935196350795335,0.7242433288113767,0.7365736288142888,0.7378569685337195,0.5999113510521907,0.599909061298482],"type":"scatter"},{"mode":"lines","name":"Best Value","x":[0,1,2,3,4,5,6,7,8,9],"y":[0.5998974061285484,0.7937263372200245,0.7937263372200245,0.7937263372200245,0.7937263372200245,0.7937263372200245,0.7937263372200245,0.7937263372200245,0.7937263372200245,0.7937263372200245],"type":"scatter"},{"marker":{"color":"#cccccc"},"mode":"markers","name":"Infeasible Trial","showlegend":false,"x":[],"y":[],"type":"scatter"}],                        {"title":{"text":"Optimization History Plot"},"xaxis":{"title":{"text":"Trial"}},"yaxis":{"title":{"text":"Objective Value"}},"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermap":[{"type":"scattermap","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}}},                        {"responsive": true}                    )                };            </script>        </div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 172-174

Now we build a learner with the best hyperparameters and fit it on the full
dataset:

.. GENERATED FROM PYTHON SOURCE LINES 176-185

.. code-block:: Python

    best_learner = pred.skb.make_learner(choose=study.best_trial)

    # This would achieve the same result:
    # best_learner = pred.skb.make_learner()
    # best_learner.set_params(**study.best_params)

    best_learner.fit(env)
    print(best_learner.describe_params())





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    {'min_samples_leaf': 1, 'regressor': 'extra_tree'}





.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (1 minutes 19.646 seconds)


.. _sphx_glr_download_auto_examples_data_ops_1131_optuna_choices.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: binder-badge

      .. image:: images/binder_badge_logo.svg
        :target: https://mybinder.org/v2/gh/skrub-data/skrub/main?urlpath=lab/tree/notebooks/auto_examples/data_ops/1131_optuna_choices.ipynb
        :alt: Launch binder
        :width: 150 px

    .. container:: lite-badge

      .. image:: images/jupyterlite_badge_logo.svg
        :target: ../../lite/lab/index.html?path=auto_examples/data_ops/1131_optuna_choices.ipynb
        :alt: Launch JupyterLite
        :width: 150 px

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: 1131_optuna_choices.ipynb <1131_optuna_choices.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: 1131_optuna_choices.py <1131_optuna_choices.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: 1131_optuna_choices.zip <1131_optuna_choices.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
